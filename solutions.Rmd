# Module 7 Exercices

## Setup

Pour commencer, nous devons charger les packages et les données que nous utiliserons dans cette session. Il y a beaucoup de nouvelles packages à utiliser, alors assurez-vous de les installer avant de continuer!

```{r}
#vous devriez déjà les avoir!
library(dplyr)
library(ggplot2)
library(janitor)

#Ceux-ci sont probablement nouveaux
library(lmerTest)
library(multcomp)
library(emmeans)
library(MuMIn)
library(agridat)


```


## Exercice 1

Nous allons commencer par un exemple apparemment simple à partir d'un ensemble de données qui est construit dans R à partir de la bibliothèque `agridat`.

Avec les jeux de données intégrés, la première fois que nous voulons les utiliser, nous les désignons par leur nom en utilisant la fonction `data`. Cet jeu de données est issu d'une expérience de 8 variétés d'orge différentes qui compare les rendements.

Exécutez le code ci-dessous pour importer ces données et voir la structure. Chaque variété est reproduite 20 fois dans cette expérience sur le même champ. La disposition en grille du champ est capturée par les champs de ligne et de colonne, les différentes variétés d'orge sont dans la colonne gen et les rendements sont dans la colonne yield.
```{r}
data(beaven.barley)
beaven.barley
```
Pour commencer, supposons que nos observations sont indépendantes - elles sont toutes sur le même terrain après tout !

*Question 1 : Faites un boxplot montrant les rendements par génotype en utilisant `ggplot`. Interprétez ce que cela montre* 

```{r}

ggplot(data=beaven.barley,aes(y=yield,x=gen))+
  geom_boxplot()

```
*Question 2: Calculez la moyenne et les écarts-types du rendement par génotype en utilisant `group_by` et` summary`* 

```{r}
beaven.barley %>%
  group_by(gen) %>%
    summarise(mean(yield),sd(yield))
```

*Question 3: Ajuster un modèle ANOVA de rendement par génotype en utilisant la fonction `lm`. Stockez-le comme un objet appelé `barley1`*

```{r}
barley1<-lm(yield~gen,data=beaven.barley)
```

*Question 4: Utilisez les fonctions de résumé et d'anova sur le modèle pour fournir des statistiques sur les résultats. Qu'est-ce que cela vous dit?*

```{r}
anova(barley1)
summary(barley1)
```

*Question 5: Utilisez la fonction plot pour vérifier les résidus. Est-ce que quelque chose semble problématique?*

```{r}
plot(barley1)
```

*Question 6: Utilisez la fonction emmeans() pour obtenir les moyennes estimées et les intervalles de confiance pour chaque génotype. Puis dirigez-le dans la fonction cld() pour effectuer l'analyse de séparation moyenne*

```{r}
emmeans(barley1,~gen)
```
```{r}
emmeans(barley1,~gen) %>%
  cld()
```

## Exercise 2

*Lorsque nous avons terminé l'exercice 1, nous avons supposé que tous les points étaient indépendants et que les facteurs de mise en page n'étaient pas pertinents. Examinons cela plus en détail.

* Question 1: En utilisant la fonction `tabyl`, produisez deux tableaux pour montrer les fréquences de combien de fois chaque génotype apparaît dans chaque ligne (tableau 1) et chaque colonne (tableau 2)*

```{r}
tabyl(beaven.barley,gen,row)
tabyl(beaven.barley,gen,col)
```

Vous devriez voir que chaque génotype apparaît 4 fois par ligne. Tous les génotypes n'apparaissent pas dans toutes les colonnes, mais il y a clairement une tentative de faire une conception équilibrée.

*Question 2: Faites deux boîtes à moustaches montrant les distributions de rendement dans chaque ligne(1) puis dans chaque colonne(2). Que remarquez-vous?*
Astuce - le message d'avertissement que vous pouvez voir essaie de vous aider! Faites attention à ce qu'il dit.
```{r}
ggplot(data=beaven.barley,aes(y=yield,x=row,group=row))+
  geom_boxplot()

ggplot(data=beaven.barley,aes(y=yield,x=col,group=col))+
  geom_boxplot()

```

*Question 3: Ajustez maintenant un modèle en utilisant lmer() et enregistrez-le un objet appelé barley2. Les effets aléatoires pour cette disposition de colonne de ligne doivent être spécifiés comme un effet aléatoire pour la ligne et un pour la colonne. Ainsi, la partie aléatoire du code du modèle devrait ressembler à "(1|row)+(1|col)"*


```{r}
barley2<-lmer(yield~gen+(1|row)+(1|col),data=beaven.barley)
```

*Question 4: Utilisez le summary(), anova(), plot() ainsi que r.squaredGLMM() pour étudier ce modèle et comparez-le aux résultats de l'exercice 1. Que remarquez-vous? Pouvez-vous expliquer les différences?*

```{r}
summary(barley2)
```

```{r}
r.squaredGLMM(barley2)
```

```{r}
anova(barley2)
```

```{r}
plot(barley2)
```


*Question 5: Effectuer l'analyse de séparation moyenne sur le nouveau modèle, pour obtenir les moyennes ajustées, les intervalles de confiance et l'affichage des lettres. Comparez à nouveau avec les résultats de l'exercice 1 - que remarquez-vous?*

```{r}
emmeans(barleymod2,~gen) %>%
  cld()
```

## Exercise 3

Revenons maintenant aux données de jachère du tutoriel

```{r}
fallow <- read.csv("Fallow N2.csv")
```

Effectuer une analyse de la façon dont le nombre de striga varie selon les différents traitements de jachère. Choisissez ce que vous pensez être un modèle sensé et tirez des conclusions sur la façon dont le striga varie selon le traitement. Faites très attention au modèle de vérification des parcelles! Il peut y avoir des problèmes où vous voudrez peut-être faire des transformations à votre variable striga!



```{r}
ggplot(data=fallow,aes(y=striga,x=treat))+
  geom_point()

ggplot(data=fallow,aes(y=striga,x=rep))+
  geom_point()

fallow %>%
  group_by(treat) %>%
    summarise(mean(striga),sd(striga),median(striga))

```



```{r}
strigamod<-lm(striga~treat,data=fallow)
```

```{r}
plot(strigamod)
```

```{r}
strigamod2<-lm(log(striga+1)~treat,data=fallow)
```

```{r}
strigamod3<-lmer(log(striga+1)~treat+(1|rep),data=fallow)
```

```{r}
anova(strigamod3)
summary(strigamod3)
```


```{r}
plot(strigamod3)
```

```{r}
anova(strigamod)
anova(strigamod2)
anova(strigamod3)
```
```{r}
r.squaredGLMM(strigamod3)
r.squaredGLMM(strigamod2)
r.squaredGLMM(strigamod)
```


```{r}
emmeans(strigamod,~treat) %>%
  cld()
```


```{r}
emmeans(strigamod2,~treat,type="response") %>%
  cld()
```

```{r}
emmeans(strigamod3,~treat,type="response") %>%
  cld()
```
